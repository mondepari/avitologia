#!/bin/bash
# Скрипт для обновления проекта

# Останавливаем скрипт при ошибках
set -e

echo "== Обновление проекта началось =="
echo "== $(date) =="

# Получаем последние изменения из Git
echo "Получение последних изменений из репозитория..."
git pull

# Создаем резервную копию базы данных
echo "Создание резервной копии базы данных..."
BACKUP_FILE="backup_$(date +%Y%m%d_%H%M%S).sql"
docker-compose exec db pg_dump -U postgres marketingdb > "$BACKUP_FILE"
echo "Резервная копия создана: $BACKUP_FILE"

# Пересобираем и запускаем контейнеры
echo "Пересборка и перезапуск контейнеров..."
docker-compose up -d --build

# Проверяем статус контейнеров
echo "Проверка статуса контейнеров..."
docker-compose ps

echo "== Обновление проекта завершено =="
echo "== $(date) =="
echo "Приложение доступно по адресу: http://localhost:5000"